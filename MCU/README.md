# MCU

---

本文件夹是 MCU 方面的代码。采用硬件平台为南京沁恒公司的无线型青稞RISC-V MCU: CH32V208WBU6 以及一块分辨率为 160*128 的 LCD 屏幕。

代码实现基于厂商提供的 peripheral 例程和 SPI_LCD 例程，加入了个人的理解和修改。

注意，这款 MCU 的 FLASH 空间非常有限，加载了 libwchble.a 后，几乎已经占用了 90% 以上的空间，因此为了实现相关功能，需要尽量压缩代码空间。在这些代码中，可能会出现大量的代码被注释，表示为了压缩代码编译结果而不得不做的优化。

## 文件夹划分

### App

最重要的是 main 函数代码 peripheral_main.c 及外围设备代码 peripheral.c。

- peripheral_main.c 为主函数，初始化完成后进入 TMOS 循环
- peripheral.c 定义了此 MCU 蓝牙模块作为一个外围设备的属性和行为

### Core

厂家提供的底层内核代码

### Debug

厂家提供的用于 Debug 的代码

### HAL

即蓝牙协议栈与芯片硬件驱动交互层

### LCD

负责所有与 LCD 屏幕通过 SPI 接口进行交互的逻辑。

- LCD_config.h 规定了与显示相关的一些细节
- LCD.c 定义了与汉字显示相关的最重要的代码

### LIB

低功耗蓝牙的协议栈库文件

### Ld

编译时用的链接文件

### Peripheral

创建项目时自动生成的文件

### Profile

此文件夹包含了包含 GAP 角色配置文件，GAP 安全配置文件和 GATT 配置文件的源代码与头文件，同时也包含 GATT 服务所需的头文件。

### Startup

启动文件

---

## 已知问题

在上下滚动时，如果文字的最后一行经过屏幕最上方时，屏幕上方会闪烁一下。
